- content_for :title, "Metrics Summary"
= include_gon
= additional_javascript('metrics')

.container-fluid.pad-edge
  %h1.pt-5 Metrics Summary

.container-fluid.p-0.m-0
  .row.m-3
    %h1.m-3.text-center Products Statistics
    #products-barchart-div.justify-content-center.bg-light-green.col-xl-6
      %h2#products-barchart-title.text-center Product Additions By Category (Total: #{@products.size})
      = bar_chart Category.joins(:products).group(:name).count, colors: ["#198754"], id: 'products-barchart-plot'

    #products-linechart-div.justify-content-center.bg-light-green.col-xl-6
      %h2#products-linechart-title.text-center Product Additions Over Time
      = line_chart Product.group_by_day(:created_at, expand_range: true).count, colors: ["#198754"], id: 'products-linechart-plot'

    #products-barchart-div.justify-content-center.bg-light-green.col-xl-6
      %h2#affiliates-barchart-title.text-center Affiliate Product Additions By Category (Total: #{@affiliate_products.size})
      = bar_chart Product.where.not(business_id: nil).joins(:category).group('categories.name').count, colors: ["#198754"], id: 'affiliates-barchart-plot'

    #affiliate-views-linechart-div.justify-content-center.bg-light-green.col-xl-6
      %h2#affiliate-views-linechart-title.text-center Affiliate Product Views Over Time (Total: #{@affiliate_views.size})
      = line_chart Product.where.not(business_id: nil).group_by_day(:created_at, expand_range: true).count, colors: ["#198754"], id: 'affiliate-views-linechart-plot'

  .row.m-3
    %h1.m-3.text-center Visitor Statistics
    #visits-barchart-div.justify-content-center.bg-light-green.col-xl-6
      %h2#visits-barchart-title.text-center Site Visits by Page (Total: #{@visits.size})
      = bar_chart Visit.group(:path).count, colors: ["#198754"], id: 'visits-barchart-plot'

    #visits-linechart-div.justify-content-center.bg-light-green.col-xl-6
      %h2#visits-linechart-title.text-center Landing Page Visits Over Time
      = line_chart Visit.group_by_day(:from, expand_range: true).count, colors: ["#198754"], id: 'visits-linechart-plot'

  .row.m-3
    %h1.mt-5.mb-3.text-center Visitor Geography Statistics
    #visits-geochart-div.justify-content-center.bg-light-green.col-xl-6
      %svg#visits-geo-plot.d-block.m-auto{width: "500px", height: "800px"}

    #registrations-geo-div.justify-content-center.bg-light-green.col-xl-6
      %h2#registrations-geo-title.text-center Site Visits By UK County
      .container
        %table#visits-geo-table.table.w-75.m-5.d-block.overflow-scroll{'height': '600px'}
          %thead
            %tr
              %th County
              %th Visitors
          %tbody#county-visits-list

  .row.m-3
    %h1.mt-5.mb-3.text-center Registration Statistics
    #registrations-barchart-div.justify-content-center.bg-light-green.col-xl-6
      %h2#registrations-barchart-title.text-center Site Registrations by Vocation (Total: #{@registrations.size})
      = bar_chart Registration.group(:vocation).count, colors: ["#198754"], id: 'registrations-barchart-plot'

    #registrations-linechart-div.justify-content-center.bg-light-green.col-xl-6
      %h2#registrations-linechart-title.text-center Site Registrations Over Time
      = line_chart Registration.group_by_day(:created_at, expand_range: true).count, colors: ["#198754"], id: 'registrations-linechart-plot'

  .row.m-3
    %h1.mt-5.mb-3.text-center Registration Geography Statistics
    #registrations-geochart-div.justify-content-center.bg-light-green.col-xl-6
      %svg#registrations-geo-plot.d-block.m-auto{width: "500px", height: "800px"}

    #registrations-geo-div.justify-content-center.bg-light-green.col-xl-6
      %h2#registrations-geo-title.text-center Site Registrations By UK County
      .container
        %table#registrations-geo-table.table.w-75.m-5.d-block.overflow-scroll{'height': '600px'}
          %thead
            %tr
              %th County
              %th Registrations
          %tbody#county-registrations-list

  .row.m-3
    %h1.mt-5.mb-3.text-center Feature Interest Statistics
    #feature-shares-div.justify-content-center.bg-light-green
      %h2#feature-shares-barchart-title.text-center Shares By Feature (Total: #{@shares.size})
      = bar_chart Share.group(:feature).count, colors: ["#198754"], id: 'feature-shares-barchart-plot'


  .row.m-3
    %h1#flow-report-title.text-center User Flow Report
    #flow-report-div.justify-content-center.bg-light-green
      .row.m-3
        .container.col-xl-4.overflow-scroll
          %table#registrations-geo-table.table.d-block.overflow-scroll{'height': '600px'}
            %thead
              %tr
                %th Registered?
                %th Session
            %tbody#sessions-list

        .container.col-xl-8.overflow-scroll
          %table#registrations-geo-table.table.d-block.overflow-scroll{'height': '600px'}
            %thead
              %tr
                %th State
                %th Page
                %th Time Spent

            %tbody#flow-list

      %svg#flow-report-plot.d-block.m-auto.col-xl-12